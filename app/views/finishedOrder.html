<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">已完成订单</h1>
    </div>
    <!-- /.col-lg-12 -->
</div>

<!-- /.row -->
<div class="row">
    <div class="col-lg-12">
        <div class="panel panel-default" ng-controller="finishedOrderCtrl">
            <div class="panel-heading">
                <div align="right">
                    <button type="button" ng-click="printAllDidiOrder()" class="btn btn-sm btn-primary">
                      <!--<button type="button" ng-click="getRestaurantList()" class="btn btn-sm btn-success">-->
                      <i class="glyphicon glyphicon-cloud-upload">
                      </i> 导出全部滴滴订单数据
                    </button>
                    <button type="button" ng-click="printMonthDidiOrder()" class="btn btn-sm btn-primary">
                      <!--<button type="button" ng-click="getRestaurantList()" class="btn btn-sm btn-success">-->
                      <i class="glyphicon glyphicon-cloud-upload">
                      </i> 导出本月滴滴订单数据
                    </button>
                    <button type="button" onclick="printExcel('o')" class="btn btn-sm btn-primary">
                        <!--<button type="button" ng-click="getRestaurantList()" class="btn btn-sm btn-success">-->
                        <i class="glyphicon glyphicon-cloud-upload">
                        </i> 导出订单数据
                    </button>
                </div>
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <table st-table="displayedCollection" st-safe-src="rowCollection" class="table table-bordered table-striped" id="o">
                    <thead>
                    <tr>
                        <th colspan="10">
                            <div class="input-group">
                                <input st-search="" class="form-control" placeholder="搜索" type="text"/>
                                <span class="input-group-btn">
                                    <button class="btn btn-default" type="button"><i class="fa fa-search"></i>
                                    </button>
                                </span>
                            </div>
                        </th>
                    </tr>
                    <tr>
                      <th width="15%" st-sort="hotelName">餐厅名称</th>
                      <th width="10%">餐厅类型</th>
                      <th width="10%" >餐厅电话</th>
                      <th width="5%"> 订单用户</th>
                      <th width="10%">就餐人数</th>
                      <th width="10%">就餐时间</th>
                      <th width="10%">预订人联系方式</th>
                      <th width="10%">会员等级</th>
                      <th width="10%">餐厅联系人</th>
                      <th width="5%">来源</th>
                      <th width="5%">状态</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr st-select-row="row" ng-repeat="row in displayedCollection">
                      <td>{{row.restaurantName}}</td>
                      <td>{{row.restaurantType}}</td>
                      <td>{{row.restaurantTel}}</td>
                      <td>{{row.userLastName}}{{row.userFirstName}}</td>
                      <td>{{row.dinerNum}}</td>
                      <td>{{row.orderTime}}</td>
                      <td><b>{{row.phoneId}}</b></td>
                      <td>{{row.userVipLevel}}</td>
                      <td>{{row.linkman}}</td>
                      <td>{{row.source}}</td>
                      <td>{{row.state}}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <!-- /.panel-body -->
        </div>
        <!-- /.panel -->
    </div>
    <!-- /.col-lg-12 -->
</div>

<script type="text/javascript">
        var idTmr;
        function  getExplorer() {
            var explorer = window.navigator.userAgent ;
            //ie
            if (explorer.indexOf("MSIE") >= 0) {
                return 'ie';
            }
            //firefox
            else if (explorer.indexOf("Firefox") >= 0) {
                return 'Firefox';
            }
            //Chrome
            else if(explorer.indexOf("Chrome") >= 0){
                return 'Chrome';
            }
            //Opera
            else if(explorer.indexOf("Opera") >= 0){
                return 'Opera';
            }
            //Safari
            else if(explorer.indexOf("Safari") >= 0){
                return 'Safari';
            }
        }
        function printExcel(tableid) {
            if(getExplorer()=='ie')
            {
                var curTbl = document.getElementById(tableid);
                var oXL = new ActiveXObject("Excel.Application");
                var oWB = oXL.Workbooks.Add();
                var xlsheet = oWB.Worksheets(1);
                var sel = document.body.createTextRange();
                sel.moveToElementText(curTbl);
                sel.select();
                sel.execCommand("Copy");
                xlsheet.Paste();
                oXL.Visible = true;

                try {
                    var fname = oXL.Application.GetSaveAsFilename("Excel.xls", "Excel Spreadsheets (*.xls), *.xls");
                } catch (e) {
                    print("Nested catch caught " + e);
                } finally {
                    oWB.SaveAs(fname);
                    oWB.Close(savechanges = false);
                    oXL.Quit();
                    oXL = null;
                    idTmr = window.setInterval("Cleanup();", 1);
                }

            }
            else
            {
                tableToExcel(tableid)
            }
        }
        function Cleanup() {
            window.clearInterval(idTmr);
            CollectGarbage();
        }
        var tableToExcel = (function() {
            var uri = 'data:application/vnd.ms-excel;base64,',
                    template = '<html><head><meta charset="UTF-8"></head><body><table>{table}</table></body></html>',
                    base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) },
                    format = function(s, c) {
                        return s.replace(/{(\w+)}/g,
                                function(m, p) { return c[p]; }) }
            return function(table, name) {
                if (!table.nodeType) table = document.getElementById(table)
                var ctx = {worksheet: name || 'Worksheet', table: table.innerHTML}
                window.location.href = uri + base64(format(template, ctx))
            }
        })()
</script>
